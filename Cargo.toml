[package]
name = "netabase_store"
version = "0.0.5"
edition = "2024"
description = "A type-safe, multi-backend key-value storage library for Rust with support for native (Sled, Redb) and WASM (IndexedDB) environments."
license = "GPL-3.0-only"
readme = "README.md"
repository = "https://github.com/newsnet-africa/netabase_store.git"
keywords = ["key-value", "storage", "wrapper", "libp2p", "wasm"]
categories = ["database"]


[workspace]
members = ["netabase_macros", "netabase_deps"]

[lib]
crate-type = ["cdylib", "rlib"]

[features]
default = ["native"]
native = ["sled", "redb", "libp2p"]
wasm = ["web-sys", "js-sys", "wasm-bindgen", "wasm-bindgen-futures", "indexed_db_futures"]
sled = ["dep:sled", "netabase_macros/sled"]
redb = ["dep:redb", "netabase_deps/redb", "netabase_macros/redb"]
# Zero-copy optimization for redb (requires redb feature)
redb-zerocopy = ["redb", "dep:ouroboros", "netabase_macros/redb-zerocopy"]
# libp2p is native-only (uses mio which doesn't support WASM)
libp2p = ["dep:libp2p"]
record-store = ["libp2p"]
# paxos is native-only (uses threading/networking)
paxos = ["dep:paxakos"]
uniffi = ["netabase_macros/uniffi"]
memory = ["default"]

[dependencies]
anyhow = "1.0.100"
bincode = { version = "2.0", features = ["derive", "serde"] }
chrono = { version = "0.4", features = ["serde"] }
derive_more = { version = "2.0.1", features = ["from", "try_into", "into"] }
netabase_deps = { version = "0.0.5", path = "netabase_deps" }
netabase_macros = { version = "0.0.5", path = "netabase_macros" }
serde = { version = "1.0", features = ["derive"] }
strum = { version = "0.27.2", features = ["derive", "strum_macros"] }
thiserror = "2.0.17"
getrandom = { version = "0.2", features = ["js"] }
typed-builder = "0.20"

# Native-only dependencies (not compatible with WASM)
sled = { version = "0.34.7", optional = true }
redb = { version = "3.1.0", optional = true }
ouroboros = { version = "0.18", optional = true }

[target.'cfg(not(target_arch = "wasm32"))'.dependencies]
libp2p = { version = "0.56.0", features = ["kad"], optional = true }
paxakos = { version = "0.13.0", optional = true }

[target.'cfg(target_arch = "wasm32")'.dependencies]
web-sys = { version = "0.3", optional = true, features = ["IdbDatabase", "IdbObjectStore", "IdbTransaction", "IdbRequest", "IdbCursorWithValue", "IdbKeyRange", "IdbTransactionMode", "IdbCursorDirection", "IdbOpenDbRequest", "IdbVersionChangeEvent", "DomException"] }
js-sys = { version = "0.3", optional = true }
wasm-bindgen = { version = "0.2", optional = true }
wasm-bindgen-futures = { version = "0.4", optional = true }
indexed_db_futures = { version = "0.5", optional = true }

[dev-dependencies]
tempfile = "3.0"
rand = "0.8"
quickcheck = "1.0"
log = "0.4"
env_logger = "0.10"

[target.'cfg(not(target_arch = "wasm32"))'.dev-dependencies]
criterion = { version = "0.5", features = ["html_reports"] }
pprof = { version = "0.13", features = ["flamegraph", "criterion"] }

[target.'cfg(target_arch = "wasm32")'.dev-dependencies]
wasm-bindgen-test = "0.3"

[[bench]]
name = "sled_wrapper_overhead"
harness = false
required-features = ["native", "libp2p"]

[[bench]]
name = "redb_wrapper_overhead"
harness = false
required-features = ["native", "libp2p"]

[[bench]]
name = "redb_zerocopy_overhead"
harness = false
required-features = ["native", "libp2p"]

[[bench]]
name = "cross_store_comparison"
harness = false
required-features = ["native", "libp2p"]

[[example]]
name = "basic_store"
required-features = ["native"]

[[example]]
name = "unified_api"
required-features = ["native"]

