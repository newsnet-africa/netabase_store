[package]
name = "netabase_store"
version = "0.1.0"
edition = "2024"

[features]
default = ["native"]
native = ["sled"]
wasm = ["web-sys", "js-sys", "wasm-bindgen", "wasm-bindgen-futures", "indexed_db_futures"]
libp2p = ["dep:libp2p"]
record-store = ["libp2p"]

[dependencies]
anyhow = "1.0.100"
bincode = { version = "2.0", features = ["derive", "serde"] }
chrono = { version = "0.4", features = ["serde"] }
derive_more = { version = "2.0.1", features = ["from", "try_into", "into"] }
libp2p = { version = "0.56.0", features = ["kad", "wasm-bindgen"], optional = true }
netabase_deps = { path = "netabase_deps" }
netabase_macros = { path = "netabase_macros" }
serde = { version = "1.0", features = ["derive"] }
sled = { version = "0.34.7", optional = true }
strum = { version = "0.27.2", features = ["derive", "strum_macros"] }
thiserror = "2.0.17"

# WASM-only dependencies
web-sys = { version = "0.3", optional = true, features = ["IdbDatabase", "IdbObjectStore", "IdbTransaction", "IdbRequest", "IdbCursorWithValue", "IdbKeyRange", "IdbTransactionMode", "IdbCursorDirection", "IdbOpenDbRequest", "IdbVersionChangeEvent", "DomException"] }
js-sys = { version = "0.3", optional = true }
wasm-bindgen = { version = "0.2", optional = true }
wasm-bindgen-futures = { version = "0.4", optional = true }
indexed_db_futures = { version = "0.5", optional = true }
redb = "3.1.0"

[dev-dependencies]
tempfile = "3.0"
rand = "0.8"
quickcheck = "1.0"
log = "0.4"
env_logger = "0.10"
criterion = "0.5"

[target.'cfg(target_arch = "wasm32")'.dev-dependencies]
wasm-bindgen-test = "0.3"

[[bench]]
name = "sled_wrapper_overhead"
harness = false

[[bench]]
name = "redb_wrapper_overhead"
harness = false

[[example]]
name = "basic_store"

